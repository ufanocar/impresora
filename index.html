<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Desglose Taxi Camp Morvedre</title>
<style>
body { font-family: Arial, sans-serif; background: linear-gradient(to right, #1d976c, #93f9b9); display:flex; flex-direction:column; align-items:center; padding:20px;}
h1 { color:#fff; text-shadow:1px 1px 3px #000; margin-bottom:15px;}
.container { background:#fff; padding:25px 20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.3); width:100%; max-width:450px;}
label { font-weight:bold; display:block; margin-top:10px; }
input, select, button { width:100%; padding:8px; margin-top:5px; border-radius:8px; border:1px solid #ccc; }
button { margin-top:15px; background-color:#1d976c; color:white; font-size:16px; border:none; cursor:pointer; }
button:hover { background-color:#148f64; }
.resultado { margin-top:20px; background:#f7f7f7; border-radius:10px; padding:15px; white-space:pre-line;}
</style>
</head>
<body>

<h1>ðŸš– Desglose de Taxi Camp Morvedre</h1>
<div class="container">
  <label for="importeFinal">Importe final (â‚¬):</label>
  <input type="number" id="importeFinal" placeholder="Ej: 12.65">

  <label for="tipo">Tipo de trayecto:</label>
  <select id="tipo">
    <option value="urbano">Urbano</option>
    <option value="interurbano">Interurbano</option>
  </select>

  <label for="horaInicio">Hora de inicio:</label>
  <input type="datetime-local" id="horaInicio">

  <button onclick="desglosar()">Calcular desglose</button>
  <div class="resultado" id="resultado"></div>
</div>

<script>
const velocidadMedia = 80; // km/h

function esNocturno(fechaHora) {
  const fecha = new Date(fechaHora);
  const hora = fecha.getHours() + fecha.getMinutes()/60;
  return (hora >= 21 || hora < 7);
}

function desglosar() {
  const importeFinal = parseFloat(document.getElementById('importeFinal').value);
  const tipo = document.getElementById('tipo').value;
  const fechaHora = document.getElementById('horaInicio').value;

  if(isNaN(importeFinal) || !fechaHora){ 
    alert("Introduce importe final y hora de inicio."); 
    return; 
  }

  const nocturno = esNocturno(fechaHora);

  // SelecciÃ³n de tarifas
  let inicio, precioKm, precioHora, nombreTarifa;
  if(tipo==="urbano") {
    if(!nocturno){ inicio=1.95; precioKm=1.08; precioHora=18.38; nombreTarifa="Urbano Diurno"; }
    else { inicio=2.65; precioKm=1.29; precioHora=19.95; nombreTarifa="Urbano Nocturno"; }
  } else {
    if(!nocturno){ inicio=1.95; precioKm=1.20; precioHora=15.00; nombreTarifa="Interurbano Diurno"; }
    else { inicio=2.65; precioKm=1.40; precioHora=17.00; nombreTarifa="Interurbano Nocturna"; }
  }

  // Subtotal antes de IVA
  const subtotal = importeFinal / 1.07;
  const iva = subtotal * 0.07;

  // Calculamos importe restante despuÃ©s de inicio
  const restante = subtotal - inicio;

  // Distribuimos entre km y tiempo usando velocidad media
  // Subtotal = inicio + (km*precioKm) + (tiempo*precioHora)
  // tiempo = km / velocidadMedia => km*precioKm + (km/velocidadMedia)*precioHora = restante
  const km = restante / (precioKm + precioHora/velocidadMedia);
  const tiempo = km / velocidadMedia;

  const resultado = `
Tarifa: ${nombreTarifa}
Fecha y hora: ${new Date(fechaHora).toLocaleString()}
Inicio: â‚¬${inicio.toFixed(2)}
KilÃ³metros: ${km.toFixed(2)} km Ã— â‚¬${precioKm.toFixed(2)} = â‚¬${(km*precioKm).toFixed(2)}
Tiempo: ${tiempo.toFixed(2)} h Ã— â‚¬${precioHora.toFixed(2)} = â‚¬${(tiempo*precioHora).toFixed(2)}
Subtotal: â‚¬${subtotal.toFixed(2)}
IVA (7%): â‚¬${iva.toFixed(2)}
Total con IVA: â‚¬${importeFinal.toFixed(2)}
Licencia: 7
Titular: CÃ©sar DÃ­az Ufano SÃ¡nchez
NIF: 50122357K
  `;

  document.getElementById('resultado').innerText = resultado;
}
</script>

</body>
</html>
